<%- include("partials/header") %>

    <style>
        .logo {
            position: relative;
            padding-left: 6%;
            top: 20px;
            left: 0px;
        } 
        .logo img {
            width: 120px;
            height: 75px;
        }
        .right-illustration {
            width: 120px;
            position: fixed;
            bottom: 20px;
            right: 20px;
            transform: scaleX(-1);
        }
        .container {
            display: flex;
            flex-direction: column;
            border: 2px solid rgba(0, 0, 0, 0.4);
            border-radius: 10px;
            padding: 0 20px;
            width: 60%;
            height: 82vh;
            margin: 0px auto;
            position: relative;
        }
        .container>div {
            padding: 9px 4px;
        }
        .container form {
            padding: 0 15px;
        }
        .container form input {
            border-color: black !important;
        }
        #form-2 {
            display: flex;
            flex-direction: column;
        }
        #form-2 img {
            display: block;
            margin: 0px auto;
            width: 50%;
        }
        #upload_widget {
            position: relative;
            display: block;
            width: 90px !important;
            margin: 0 auto;
            margin-top: -16%;
            z-index: 30;
            background: black;
        }
        #form-3 {
            display: flex;
            justify-content: space-around;
            align-items: center;
        }
        #form-3 button {
            margin: 100px auto;
        }
        #form-3 img {
            margin-left: 100px;
            width: 36%;
            height: 100%;
        }
        .prev, .next{
            background: #3A49CD !important;
        }
        .error-box{
            display: none;
            color:red;
            font-size:12px;
        }
        .error-tooltip{
            display:none;
            color:red;
            font-size:12px;
        }
        .img-upload-tooltip{
            font-size:15px;
            color:blue;
            display:none;
        }
    </style>
    <img class="right-illustration" src="images/illustration_register.svg" alt="illustration_register">

    <a href="/" class="logo">
        <img src="/images/logo.svg" alt="logo" />
    </a>

    <div class="container">
        <div class="form-heading">
            <h2 style="font-size: 1.8rem;">SIGN UP</h2>
            <button style="float: right;display:none;" class="prev ui circular facebook icon button">
                <i class="angle left icon"></i>
            </button>
            <button style="float: right;" class="next ui circular facebook icon button">
                <i class="angle right icon"></i>
            </button>
            <p style="font-size: 1.3rem;">Enter your details below</p>
        </div>
        <!-- Heading 2 -->
        <div class="form-heading">
            <h2 style="font-size: 1.8rem;">SIGN UP</h2>
            <button style="float: right;" class="next ui circular facebook icon button">
                <i class="angle right icon"></i>
            </button>
            <button style="float: right;" class="prev ui circular facebook icon button">
                <i class="angle left icon"></i>
            </button>
            <p style="font-size: 1.3rem;">ID Verification for JSS students</p>
        </div>
        <!--Heading 3-->
        <div class="form-heading">
            <h2 style="font-size: 1.8rem;">SIGN UP</h2>
            <button style="float: right;" class="prev ui circular facebook icon button">
                <i class="angle left icon"></i>
            </button>
            <button style="float: right;display:none;" class="next ui circular facebook icon button">
                <i class="angle right icon"></i>
            </button>
            <p style="font-size: 1.3rem;">Success ! Your ID card is uploaded and will be verified within 24 hours.</p>
        </div>
        <!--Form -->
        <form action="/register" method="POST" class="ui form">

            <!--Form 1-->
            <div class="register-form">
                <div class="field">
                    <label>Admission Number</label>
                    <input id="college-id" class="user-details" placeholder="Admission Number"  name="username" type="text" required>
                    <p class="error-box">*Admission number is already registered</p>
                    <p class="error-tooltip">
                        *Admission Number is required
                    </p>
                </div>
                <div class="two fields">
                    <div class="field">
                        <label>First Name</label>
                        <input class="user-details" placeholder="First Name" name="fname" type="text" required>
                        <p class="error-tooltip">
                            *This field is required
                        </p>
                    </div>
                    <div class="field">
                        <label>Last Name</label>
                        <input class="user-details" placeholder="Last Name" name="lname" type="text" required>
                        <p class="error-tooltip">*This field is required</p>
                    </div>
                </div>
                <div class="field">
                    <label>Email</label>
                    <input class="user-details" placeholder="Your Email" name="email" type="email" required>
                    <p class="error-tooltip">*This field is required</p>
                </div>
                <div class="two fields">
                    <div class="field">
                        <label>Password</label>
                        <input class="user-details" placeholder="Password" name="password" type="password" required>
                        <p class="error-tooltip">*Password Field cannot be empty</p>
                    </div>
                    <div class="field">
                        <label>Confirm Password</label>
                        <input class="user-details" placeholder="Confirm Password" type="password" required>
                        <p class="error-tooltip"></p>
                    </div>
                </div>
            </div>
            <!--Form 2-->
            <div class="register-form" id="form-2">
                <label class="img-upload-tooltip">ID Card Img Uploaded Successfully!!!</label>
                <img src="images/upload_register.svg" alt="upload_register">
                <button type="button" id="upload_widget" class="ui secondary button">
                    Upload
                </button>
                <input style="display:none;" type="text" name="cardImg" id="id_card_img_url" value="">
            </div>
            <!--Form 3-->
            <div class="register-form" id="form-3">
                <label style="display:none;" id="error-tooltip">Id Card Upload is Must</label>
                <img src="images/status_register.svg" alt="status_register">
                <button id="submit-btn" class="ui huge primary submit button" type="submit" style="background: #3A49CD;">
                    JOIN NOW
                </button>
            </div>
        </form>
        <!--Status Bar -->
        <div class="ui three steps" style="position: absolute;bottom: 0;left: 0;padding: 0;">
            <div class="active step">
                <i class="user circle icon"></i>
                <div class="content">
                    <div class="title">Account</div>
                    <div class="description">Enter Your Account Details</div>
                </div>
            </div>
            <div class="step">
                <i class="portrait icon"></i>
                <div class="content">
                    <div class="title">Id Verification</div>
                    <div class="description">Upload College I'd card Photograph</div>
                </div>
            </div>
            <div class="step">
                <i class="user check icon"></i>
                <div class="content">
                    <div class="title">Status</div>
                    <div class="description">Verify Account Detaials</div>
                </div>
            </div>
        </div>
    </div>
    <!--Custom JavaScript-->
   <!--Cloudinary Image Uploda Widget-->
   <script src="https://upload-widget.cloudinary.com/global/all.js" type="text/javascript"></script>
   <script src='/js/cloudinary.js'></script>
    <script>
        console.log(idCardImgUrl)
        const errorBox = document.querySelector(".error-box")
        const collegeId = document.getElementById("college-id");
        const errorToolTip = document.querySelectorAll(".error-tooltip")
         /* Prev and Next Button */
        const prevBtn = document.querySelectorAll('.prev');
        const nextBtn = document.querySelectorAll('.next');
        let admissionError=true
        collegeId.addEventListener("keyup",(e)=>{
            console.log("hello")
            setTimeout(async()=>{
                const res = await fetch(`/validate/check/${collegeId.value}`)
                const data = await res.json()
                console.log(data)
                /* Error Tooltip when Username is not availabel */
                if(data.success==false){
                    errorBox.style.display="block";
                    admissionError=false
                 }
                 else{
                    errorBox.style.display="none";
                    admissionError=true
                 }

            },5000)
        })
        
        /* Forms */
        const form = document.querySelectorAll('.register-form');
        /*Headings */
        const heading = document.querySelectorAll('.form-heading');
        const steps = document.querySelectorAll('.step');
        // setting heading and form display to none
        form[1].style.display = "none";
        form[2].style.display = "none";
        heading[1].style.display = "none";
        heading[2].style.display = "none";
        steps[0].classList.add("active");
        steps[1].classList.remove("active");
        steps[2].classList.remove("active");
        /* Form Validation */
        function form_validation(){
              /* Form Validation */
        const userDetails = document.querySelectorAll(".user-details")
        entriesFilled=true
        passwordMatched=false
       
        // Password Validation
        if(userDetails[4].value== userDetails[5].value){
            passwordMatched = true
            errorToolTip[4].style.display="none";
        }
        else{
            errorToolTip[4].style.display="block";
            errorToolTip[4].innerHTML="Password & Confirm Password doesn't match"
        }

        for(let i=0;i<userDetails.length-1;i++){
            if(userDetails[i].value==""){
                errorToolTip[i].style.display="block";
                entriesFilled=false
                 break;
            }
        }
        
        if(passwordMatched && entriesFilled) 
             return true;
        else 
            return false;
        }
        
        // Prev and Next Functionality
        for (let i = 0; i < nextBtn.length; i++) {
            nextBtn[i].addEventListener("click", () => {
                // forms
               let result=form_validation();
               console.log(result)
               
               if(result==true && admissionError==true){
                form[(i + 1) % 3].style.display = "flex";
                form[i].style.display = "none";
                form[(i + 2) % 3].style.display = "none";
                // headings
                heading[(i + 1) % 3].style.display = "block";
                heading[i].style.display = "none";
                heading[(i + 2) % 3].style.display = "none";
                // steps
                steps[(i + 1) % 3].classList.add("active");
                steps[i].classList.remove("active");
                steps[(i + 2) % 3].classList.remove("active");

                for(let j=0;j<errorToolTip.length;j++){
                    errorToolTip[j].style.display="none";
                }
               }
              
            });
        }
        /* Prev Btn Functionality */
        for (let i = 0; i < prevBtn.length; i++) {
            prevBtn[i].addEventListener("click", () => {
                for(let j=0;j<errorTooltip.length;j++){
                    errorToolTip[j].style.display="none";
                }
                // forms
                form[i % 3].style.display = "none";
                form[(i + 1) % 3].style.display = "none";
                if (i == 1) {
                    form[(i - 1) % 3].style.display = "block";
                }
                else {
                    form[(i - 1) % 3].style.display = "flex";
                }
                // headings
                heading[i % 3].style.display = "none";
                heading[(i - 1) % 3].style.display = "block";
                heading[(i + 1) % 3].style.display = "none";
                // steps
                steps[(i - 1) % 3].classList.add("active");
                steps[i%3].classList.remove("active");
                steps[(i + 1) % 3].classList.remove("active");
            });
        }
      
       const submitBtn = document.getElementById("submit-btn")
       const errorTooltip = document.getElementById("error-tooltip")
      // Submit Btn Functionality
       submitBtn.addEventListener("click",(e)=>{
           console.log("here")
           if(idCardImgUrl.value==""){
            submitBtn.disabled=true;
             errorTooltip.style.display="block";

             setTimeout(()=>{
                 errorTooltip.style.display="none";
                 submitBtn.disabled=false;
             },5000)
            }
            
       })
       



      
    </script>
